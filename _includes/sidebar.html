<nav class="sidebar-nav">
  <div class="sidebar-title">ðŸ“š Knowledge Repository</div>
  {% assign current_url = page.url %}
  {% assign pages = site.pages | where_exp: "p", "p.path contains 'docs/'" %}
  {% assign sorted_pages = pages | sort: "path" %}

  {% assign previous_indent = 0 %}
  {% assign open_tags = "" %}

  {% for page in sorted_pages %}
    {% assign segments = page.path | remove: 'docs/' | split: '/' %}
    {% assign indent = segments.size %}
    {% assign filename = segments | last %}
    {% assign is_file = filename contains '.md' or filename contains '.html' %}
    {% assign display_title = page.title | default: filename | replace: '.md', '' | replace: '.html', '' | capitalize %}

    {%- comment -%}
    Adjust open/close tags based on depth difference
    {%- endcomment -%}
    {% assign diff = previous_indent | minus: indent %}
    {% if diff > 0 %}
      {% for i in (1..diff) %}
        </ul></details>
      {% endfor %}
    {% endif %}

    {% assign previous_indent = indent %}

    {%- comment -%}
    Render folders as <details>, files as <li>
    {%- endcomment -%}
    {% if is_file %}
      <li>
        <a href="{{ page.url }}" class="{% if current_url == page.url %}active{% endif %}">{{ display_title }}</a>
      </li>
    {% else %}
      <details class="sidebar-section" {% if current_url contains filename %}open{% endif %}>
        <summary>{{ filename | capitalize }}</summary>
        <ul class="sidebar-links">
    {% endif %}
  {% endfor %}

  {%- comment -%} Close remaining open tags {%- endcomment -%}
  {% for i in (1..previous_indent) %}
    </ul></details>
  {% endfor %}
</nav>
