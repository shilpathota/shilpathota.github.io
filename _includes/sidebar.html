<nav class="sidebar-nav">
  {% assign pages_by_folder = site.pages | where_exp: "item", "item.path contains 'docs/'" %}
  {% assign grouped = pages_by_folder | group_by_exp: "item", "item.path | split: '/' | slice: 1, 1 | first" %}

  {% for section in grouped %}
    {% assign section_name = section.name | capitalize %}
    <details class="sidebar-section" {% if page.path contains section.name %} open {% endif %}>
      <summary class="sidebar-section-title">{{ section_name }}</summary>
      <ul class="sidebar-links">
        {% for subpage in section.items %}
          {% assign display_title = subpage.title | default: subpage.path | split: '/' | last | replace: ".md", "" | replace: ".html", "" %}
          
          {% if display_title == "index" or display_title == "Index" %}
            {% assign display_title = section_name %}
          {% endif %}
          
          <li>
            <a href="{{ subpage.url }}" class="{% if page.url == subpage.url %}active{% endif %}">
              {{ display_title }}
            </a>
          </li>
        {% endfor %}
      </ul>
    </details>
  {% endfor %}
</nav>
